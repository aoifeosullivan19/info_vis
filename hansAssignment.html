<!DOCTYPE html>
<html lang = "en" class="tas-com">
<head>
	<meta charset="utf-8">
	<title>D3 Assignment</title>
	<link href="./themes/prism.css" rel="stylesheet" />
	<link href="./themes/tas_style.css" rel="stylesheet" />
	<script type="text/javascript" src="./d3/d3.v4.js" charset="utf-8"></script>
	<script src="./lib/prism.js" charset="utf-8"></script>
	<style type="text/css">
		.axis path,
		.axis line {
		    fill: none;
		    stroke: black;
		    shape-rendering: crispEdges;
		}
		
		.axis text {
		    font-family: sans-serif;
		    font-size: 11px;
		}	
        
        div.tooltip {	
    position: absolute;			
    text-align: center;			
    width: 60px;					
    height: 28px;					
    padding: 2px;				
    font: 12px sans-serif;		
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;			
}
        
          
        /* http://bl.ocks.org/d3noob/a22c42db65eb00d4e369 */
	</style>
</head>
<body>

	<h1>Channelling Hans</h1>
    
            
            
	<div class="slidecontainer">
<button type="button" id="play">Play</button>
	<button type="button" id="pause">Pause</button>
  <input type="range" min="2007" max="2017" value="1" class="slider" id="sliderRange">
          <p>Year: <span id="year"></span></p>
</div>
            
		<script type="text/javascript" id = "demo_code">

// Define margins
var margin = {top: 20, right: 20, bottom: 55, left: 90};

//Width and height
var outer_width = 700;
var outer_height = 500;
var svg_width = outer_width - margin.left - margin.right;
var svg_height = outer_height - margin.top - margin.bottom;

//Define a date parser
var formatDate = d3.timeParse("%y");

// The global data set object
var dataset;


// Set up the scale to be used on the x axis
xScale = d3.scaleLinear()
				.range([20, svg_width]);
        

// Set up the scale to be used on the y axis
yScale = d3.scaleLinear()
				.range([svg_height, 0]);
            
rScale=d3.scaleSqrt()
               .range([1, 20]);
            
var circleColor=d3.scaleOrdinal(d3.schemeCategory20);

			
// Create an x-axis connected to the x scale
var xAxis = d3.axisBottom()
			  	.scale(xScale)
				.ticks(10);

//Define Y axis
var yAxis = d3.axisLeft()
				  .scale(yScale)
				  .ticks(10);
							  

var div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);
            

//Create SVG element as a group with the margins transform applied to it
var svg = d3.select("body")
			.append("svg")
			.attr("width", svg_width + margin.left + margin.right)
			.attr("height", svg_height + margin.top + margin.bottom)
			.append("g")
			.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
			

display_year=2007;

// define a function that filters data by year
function yearFilter(value){
	return (value.Year == display_year)
}

            

function generateVis(){


    
    	// Filter the data to only include the current year
	var filtered_dataset = dataset.filter(yearFilter);
 console.log(filtered_dataset);

//	// Update the axis domains based on the loaded data
	xScale.domain([0, d3.max(dataset, function(d) { return +d.GDP;}) ])
	yScale.domain([0, d3.max(dataset, function(d) { return +d.Global_Competitiveness_Index; })]);


	// Call the axes objects
	svg.select("#x-axis").call(xAxis);
	svg.select("#y-axis").call(yAxis);
    
    	/******** PERFORM DATA JOIN ************/
	  	// Join new data with old elements, if any.
		var points = svg.selectAll("circle")
							.data(filtered_dataset);


    
   
    
		/******** HANDLE UPDATE SELECTION ************/
	  	// Update the display of existing elelemnts to mathc new data
	  	// Perform a data join and add points to the chart

 
        points
        .transition()
    .duration(300)
//      .ease(d3.easeBack)
            .attr("cx",function(d){
									return xScale(d.GDP);
								})
    		.attr("cy", function(d){
									return yScale(d.Global_Competitiveness_Index);
								})
            .attr("r", function(d){
                                    return rScale(d.Population);
     
        })
		   	.style("fill", function (d) {
                                    return circleColor(d.Country)
                       })
//      .on("mouseover", function(d) {		
//            d3.select(this)
//              //  .transition()
//                .duration(100)		
//                .style("opacity", .99);		
//            div.html(d.Country)	
//                .style("left", (d3.event.pageX) + "px")		
//                .style("top", (d3.event.pageY + 5) + "px");	
//            })	
    ;


		/******** HANDLE ENTER SELECTION ************/
	  	// Create new elements in the dataset
	  	// Perform a data join and add points to the chart
    
 
		points.enter()
			.append("circle")
                .transition()
                .duration(2000)
          .ease(d3.easeBounce)
				.attr("cx", function(d){
									return xScale(d.GDP);
								})
				.attr("cy", function(d){
									return yScale(d.Global_Competitiveness_Index);
								})
				.attr("r", function(d){
                                    return rScale(d.Population);
     
        })
				.style("fill", function (d) {
                                    return circleColor(d.Country)
                       })

//                 .on("mouseover", function(d) {		
//            div.transition()		
//                .duration(100)		
//                .style("opacity", .99);		
//            div	.html(d.Country)	
//                .style("left", (d3.event.pageX) + "px")		
//                .style("top", (d3.event.pageY + 5) + "px");	
   //         })			// http://bl.ocks.org/d3noob/a22c42db65eb00d4e369 //		
    ;


    
    
		/******** HANDLE EXIT SELECTION ************/
		// Remove elements that not longer have a matching data eleement
		points.exit()
    
            .remove();
    	
    points.    on("mouseover", function(d) {		
            d3.select(this)
                div.transition()
                .duration(100)		
                .style("opacity", .99);
            div.html(d.Country)	
      
                .style("left", (d3.event.pageX) + "px")		
                .style("top", (d3.event.pageY + 5) + "px")   ;})
           .on("mouseout", function(d) {
       div.transition()
         .duration(500)
         .style("opacity", 0);
       
       ;})
    
     points
                    
                    .style("opacity", 0.1);
    ;
   //  	https://bl.ocks.org/d3noob/257c360b3650b9f0a52dd8257d7a2d73
            	
    
	// Set the year label
	d3.select("#year_header").text("Year: " + display_year)
} 
            
function generateScatter() {
       	// Filter the data to only include the current year
	

//	// Update the axis domains based on the loaded data
	xScale.domain([0, d3.max(dataset, function(d) { return +d.GDP;}) ])
	yScale.domain([0, d3.max(dataset, function(d) { return +d.Global_Competitiveness_Index; })]);


	// Call the axes objects
	svg.select("#x-axis").call(xAxis);
	svg.select("#y-axis").call(yAxis);
    
    	/******** PERFORM DATA JOIN ************/
	  	// Join new data with old elements, if any.
		var points = svg.selectAll(".dot")
							.data(dataset);
     points.enter().append("circle")
      .attr("class", "dot")
      .attr("r", 5)
      .attr("cx", function(d){
									return xScale(d.GDP);
								})
      .attr("cy", function(d){
									return yScale(d.Global_Competitiveness_Index);
								})
      .style("fill", function (d) {
                                    return circleColor(d.Country)
                       });

        
    
}
            
// Load the file data.csv and generate a visualisation based on it
	d3.csv("./data/GCI_CompleteData4.csv", function(error, data){
		
		// handle any data loading errors
		if(error){
			console.log("Something went wrong");
			console.log(error);
		}else{
			console.log("Data Loaded");
      
	// Assign  the data object loaded to the global dataset variable
			dataset = data;
            generateVis();
            

	// A global variable for the interval listeneer so that it can be stopped elsewhere
	var playInterval;	
	    
  var select = d3.select("body")
      .append("div")
      .append("select")

    select
      .on("change", function(d) {
        var value = d3.select(this).property("value");
        
        alert(value);
        generateScatter;
      });


    select.selectAll("option")
      .data(data)
      .enter()
        .append("option")
        .attr("value", function (d) { return d.value; })
        .text(function (d) { 
                           return(d.Country)   });
            
       
//https://stackoverflow.com/questions/24588883/populate-dropdown-list-with-csv-file-d3
	// Add an event listener to the play all button do that when it is clicked the visualisaiton iterates through the different years
		
            d3.select("stop_button")
		.on("click", function() {
                		clearInterval(playInterval);
            })

            
                        
var slider = document.getElementById("sliderRange");
var output = document.getElementById("year");
output.innerHTML = slider.value; // Display the default slider value

// Update the current slider value (each time you drag the slider handle)
slider.oninput = function() {
    output.innerHTML = this.value;
        display_year = output.innerHTML;
		generateVis();
}
d3.select(".play")
		.on("click", function() {

			// Set up the interval callback
			playInterval = setInterval(function() {
			 
			// Increment the display year
			display_year++;
						
			// Make the display_year loop around from max to min
			if(display_year > 2017){
				display_year = 2007;
			}
			
			// Update the visualsiation
			generateVis();

			}, 1000);
		});	
            
            d3.select("#play").on("click", function() {
                clearInterval(playInterval);
                playInterval=setInterval(function() {
                    	var selection= d3.select(slider);
                        var yearUpdate = (+selection.property("value") + 1) % (+selection.property("max") + 1);
                        if (yearUpdate == 0) { yearUpdate = +selection.property("min"); }
                        selection.property("value", yearUpdate);
                    display_year=yearUpdate;
                    
                    generateVis();
                     output.innerHTML = yearUpdate;
                      
    }, 600);
                });
            //https://jsfiddle.net/bfbun6cc/60/

            d3.select("#pause").on("click", function() {
	clearInterval (playInterval);
});

			// Set the domains of the x and y scales using the data
			var max_close = d3.max(dataset, function(d) { return d.Global_Competitiveness_Index;} );
			var max_date = d3.max(dataset, function(d) { return d.GDP;} );
			var min_date = d3.min(dataset, function(d) { return d.GDP;} );
		
			xScale.domain([min_date, max_date]);
			yScale.domain([0, max_close]);
            rScale.domain([0, d3.max(dataset, function(d) { return +d.Population;}) ])
            


			// Create the x-axis
			svg.append("g")
				.attr("class", "axis")
				.attr("id", "x-axis")
				.attr("transform", "translate(0," + svg_height + ")")
				.call(xAxis)
            	.append("text")
				      .attr("y", 50)
                      .attr("x", 330)
                    .style("font-size", "15px")
                        .attr("font-family", "sans-serif")
                      .attr("fill", "black") 
				      .style("text-anchor", "end")
				      .text("GDP");
				
			// Create the y axis
			svg.append("g")
				.attr("class", "axis")
				.attr("id", "y-axis")
				.call(yAxis)
            
				.append("text")
				      .attr("transform", "rotate(-90)")
            
            .attr("fill", "black") 
            .style("font-size", "15px")
				      .attr("y", -60)
                        .attr("x", -130)
				      .attr("dy", ".71em")
				      .style("text-anchor", "end")
				      .text("Global Competitive Index");
            
     //       generateVis();

				
        	// Generate the visualisation
//			setInterval(function() {
//			display_year = display_year + 1;
//			if(display_year > 2017){
//				display_year = 2007;
//			}
//		  	generateVis();
//		}, 2000);	
	}

 

	
		
	});
		</script>
		</div>

	
	</div>
</body>	 
</html>